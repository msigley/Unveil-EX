/**
 * jQuery Unveil EX
 * 1.1.1
 * A lightweight and feature rich plugin to lazy load images.
 *
 * Licensed under the MIT license.
 * By Matthew Sigley
 * https://github.com/msigley/
 */
(function(a){a.unveilGetIEVersion=function(){var a="undefined"!==typeof navigator?navigator.userAgent:"";return/msie|trident/i.test(a)?(a=a.match(/(?:msie |rv:)(\d+(\.\d+)?)/i))&&1<a.length&&a[1]||"":""};var f="";f=bowser.msie?bowser.version:a.unveilGetIEVersion();a.unveilCallIndex=0;a.unveilCallStack=[];a.unveilEventTimers=[];a.unveilMutationObserver=!1;a.unveilPrintText=!1;a.unveilPrintEventsLeft=!1;a.unveilPrintEventsCallPrintAfter=!1;a.unveilIsImageLoaded=function(a){return!a.complete||"undefined"!=
typeof a.naturalWidth&&0==a.naturalWidth?!1:!0};a.unveilIsVisible=function(a){if(null===a.offsetParent)return!1;if(""!==f&&11>f){var b="";"undefined"!=typeof getComputedStyle?b=window.getComputedStyle(a).display:"undefined"!=typeof a.currentStyle&&(b=a.currentStyle.display);if("none"==b||"fixed"==b||"absolute"==b)return!1}return!0};a.unveilInDOM=function(a){return document.body.contains(a)};a.unveilHasEvent=function(b){return(b=a._data(b,"events"))&&b.unveil?!0:!1};a.unveilImagesInView=function(){a.unveilCallStack.forEach(function(a){a()})};
a.unveilAndPrint=function(){var b=a("img").not(".no-lazy-load img").filter(function(){return a.unveilHasEvent(this)});a.unveilPrintEventsLeft=b.length;0<a.unveilPrintEventsLeft?(a.unveilPrintEventsCallPrintAfter=!0,b.trigger("unveil")):window.print()};a.fn.unveil=function(b,f){var h=a(window),m=b||0,c=this;if(!a.unveilMutationObserver&&"MutationObserver"in window){var t=function(e){var d;for(d=0;d<e.length;d++){var k=e[d];var b;for(b=0;b<k.addedNodes.length;b++)if(1===k.addedNodes[b].nodeType){var c=
a(k.addedNodes[b]);c.has("img")&&c.find("img").trigger("unveil")}}};a.unveilMutationObserver=new MutationObserver(function(a){setTimeout(t,0,a)});a.unveilMutationObserver.observe(document.body,{childList:!0,subtree:!0})}"complete"!=document.readyState&&c.each(function(){var e=a(this);dataSource=this.getAttribute("data-src");dataSourceSet=this.getAttribute("data-srcset");if(!(dataSource||dataSourceSet||a.unveilIsImageLoaded(this))&&(a.unveilMutationObserver||a.unveilIsVisible(this))){var d=this.getAttribute("src"),
b=this.getAttribute("srcset");d&&(this.setAttribute("data-src",d),this.setAttribute("src",""));b&&(this.setAttribute("data-srcset",b),this.setAttribute("srcset",""));d=e.get(0).cloneNode(!0);d.width||(e.width(1),this.setAttribute("data-fake-width",!0));d.height||(e.height(1),this.setAttribute("data-fake-height",!0));"inline"==e.css("display")&&e.css("display","inline-block")}});a.unveilPrintText||(a.unveilPrintText=a('<h1 class="print-only">Images not loaded yet. Please close and reopen your print preview.</h1>'),
a.unveilPrintText.css("color","#fff"),a.unveilPrintText.hide().prependTo(document.body));c.one("unveil",function(){this.unveilAttributeObserver&&(this.unveilAttributeObserver.disconnect(),this.unveilAttributeObserver=null);var b=a(this),d=this.getAttribute("data-src"),c=this.getAttribute("data-srcset");d&&(this.setAttribute("src",d),this.removeAttribute("data-src"));c&&(this.setAttribute("srcset",c),this.removeAttribute("data-srcset"));this.getAttribute("data-fake-width")&&(b.width("auto"),this.removeAttribute("data-fake-width"));
this.getAttribute("data-fake-height")&&(b.height("auto"),this.removeAttribute("data-fake-height"));(d||c)&&"function"===typeof f&&f.call(this);!1!==a.unveilPrintEventsLeft&&setTimeout(function(){a.unveilPrintEventsLeft--;1>a.unveilPrintEventsLeft&&(a.unveilPrintText&&a.unveilPrintText.remove(),a.unveilPrintEventsCallPrintAfter&&window.print())},1E3)});if(a.unveilMutationObserver){var u=function(b){var d;for(d=0;d<b.length;d++){var c=b[d];console.log(c);a.unveilIsVisible(c.target)&&a(c.target).trigger("unveil")}};
c.each(function(){this.unveilAttributeObserver||(this.unveilAttributeObserver=a.unveilMutationObserver=new MutationObserver(u),this.unveilAttributeObserver.observe(this,{attributes:!0}))})}var g=a.unveilCallIndex,l=function(){clearTimeout(a.unveilEventTimers[g]);var b=c.filter(function(){var b=a(this);if(!a.unveilIsVisible(this))return!a.unveilMutationObserver;var c=h.scrollTop(),e=c+h.height(),f=b.offset().top;return f+b.height()>=c-m&&f<=e+m}).trigger("unveil");c=c.not(b);c=c.filter(function(){return a.unveilInDOM(this)});
c=c.filter(function(){return a.unveilHasEvent(this)});c.length||h.off(".unveil"+g)};a.unveilCallStack.push(l);var n=function(){var b=a("img").not(".no-lazy-load img").filter(function(){return a.unveilHasEvent(this)});b.length?(a.unveilPrintEventsLeft=b.length,a.unveilPrintText&&a.unveilPrintText.show(),b.trigger("unveil")):a.unveilPrintText&&a.unveilPrintText.remove()};h.on("scroll.unveil"+g+" resize.unveil"+g,function(){clearTimeout(a.unveilEventTimers[g]);a.unveilEventTimers[g]=setTimeout(l,20)});
l();if("onbeforeprint"in window){var p=function(){window.removeEventListener("beforeprint",p);n()};window.addEventListener("beforeprint",p)}else if(window.matchMedia){var q=window.matchMedia("print"),r=function(a){a.matches&&(q.removeListener(r),n())};q.addListener(r)}a.unveilCallIndex++;return this}})(window.jQuery||window.Zepto);
